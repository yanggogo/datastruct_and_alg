# C字节对齐

## 自然对齐

char 自然对齐的长度为1字节
short 为2字节
int 为4字节
double 为8字节

结构体或类的对齐为其成员中最大的那个值

## 指定对齐

#pragma pack(n)
#pragma pack()

32位系统，默认#pragma pack(4)
64位系统，默认#pragma pack(8)

## 生效对齐

自然对齐和指定对齐的最小值

## 实践

```c
typedef struct Data {
    char a;
    short b;
    int c;
    double d;
} Data_t;

// sizeof(Data_t) = 2 + 2 + 4 + 8 = 16
```

```c
typedef struct Data {
    char a;
    short b;
    int c;
    double d;
    char e;
} Data_t;
// 为什么增加一个char e就需要增加8字节？ ---- 因为整个结构体大小也要遵循自然和指定对齐规则，
// （32为系统，按默认的指定4字节对齐） 或 （64位系统，按默认的指定8字节对齐）
// sizeof(Data_t) = 2 + 2 + 4 + 8 + 8 = 24
```

```c
#pragma pack(1)
typedef struct Data {
    char a;
    short b;
    int c;
    double d;
} Data_t;
#pragma pack()

// sizeof(Data_t) = 1 + 2 + 4 + 8 = 15
```

```c
#pragma pack(2)
typedef struct Data {
    char a;
    short b;
    int c;
    double d;
} Data_t;
#pragma pack()

// sizeof(Data_t) = 2 + 2 + 4 + 8 = 16
```

```c
#pragma pack(4)
typedef struct Data {
    char a;
    short b;
    int c;
    double d;
} Data_t;
#pragma pack()

// sizeof(Data_t) = 2 + 2 + 4 + 8 = 16
```
